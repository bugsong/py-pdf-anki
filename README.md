# py-pdf-anki
输入问题，配合截取PDF形成问答题类型卡片
PDF到Anki问答题工具

这是一个基于Python的桌面应用程序，可以将PDF文档中的内容转换为Anki问答题卡片。用户可以选择PDF页面中的任意区域作为答案，输入问题后直接添加到Anki中。

## 功能特点

- 📄 **PDF浏览**：支持打开和浏览PDF文档
- 🔍 **区域选择**：鼠标拖拽选择PDF页面中的任意区域
- 🖼️ **图像截取**：将选择的区域转换为高质量图像
- 🔧 **缩放控制**：支持放大、缩小和适应页面显示
- 📝 **问题输入**：为选择的区域输入对应的问题
- 🎴 **Anki集成**：直接将问题和答案添加到Anki卡片
- 🎯 **拖拽调整**：可以拖拽调整已选择的区域
- 🧹 **清除重选**：支持右键或按钮清除选择重新开始
- 🎨 **高清预览**：使用300 DPI渲染，提供更清晰的PDF预览质量
- ⚡ **连续创建**：添加卡片后自动清除选择，支持在同一页面连续创建多张卡片
- 💾 **可选保存**：可选择是否将图片保存到本地，默认不保存以节省空间

## 安装说明

### 1. 环境要求

- Python 3.7 或更高版本
- Anki（用于存储卡片）
- AnkiConnect插件（用于与Anki通信）

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 安装AnkiConnect插件

1. 打开Anki
2. 菜单栏选择：工具 → 插件 → 浏览并安装插件
3. 输入插件代码：`2055492159`
4. 点击确定安装
5. 重启Anki

## 使用方法

### 1. 启动程序

```bash
python main.py
```

### 2. 基本操作流程

1. **选择PDF文件**：点击"选择PDF"按钮，选择要处理的PDF文档
2. **浏览页面**：使用"上一页"/"下一页"按钮浏览PDF页面
3. **缩放调整**：使用"+"/"-"按钮或鼠标滚轮调整显示大小
4. **选择区域**：在PDF页面上拖拽鼠标选择要作为答案的区域
5. **调整选择**：可以拖拽已选择的区域调整位置
6. **输入问题**：在问题输入框中输入对应的问题
7. **添加到Anki**：点击"添加到Anki"按钮创建卡片
8. **继续操作**：程序会自动清除选择，可以继续创建下一张卡片

### 3. 快捷操作

- **鼠标滚轮**：放大/缩小PDF页面
- **右键点击**：清除当前选择
- **拖拽选择区域**：调整已选择区域的位置
- **适应页面**：自动调整缩放比例以适应窗口大小

### 4. 注意事项

- 确保Anki已打开且AnkiConnect插件已启用
- 程序默认使用"问答题"卡片类型，请确保Anki中存在此类型
- 如果卡片类型不存在，可以在Anki中创建或修改代码中的`modelName`
- 选择区域时，过小的区域会被自动清除

## 故障排除

### 1. 连接Anki失败

如果出现"无法连接到AnkiConnect"错误：

1. 确认Anki已打开
2. 确认AnkiConnect插件已安装并启用
3. 确认AnkiConnect运行在默认端口8765
4. 尝试重启Anki

### 2. 卡片类型不存在

如果出现"model was not found"错误：

1. 在Anki中创建名为"问答题"的卡片类型
2. 或修改代码中的`modelName`为Anki中已存在的卡片类型

### 3. PDF显示问题

如果PDF显示异常：

1. 确认PDF文件没有损坏
2. 尝试使用"适应页面"功能
3. 检查是否安装了最新版本的PyMuPDF
4. 确认PIL库已正确安装：`pip install Pillow`

### 4. 界面控件错误

如果出现"NameError: name 'control_frame' is not defined"错误：

1. 确认使用的是最新版本的程序
2. 检查Python环境是否正确
3. 重新启动程序

### 5. 图像处理错误

如果出现"nameimagetk'isnotdefined"错误：

1. 确认Pillow库已正确安装：`pip install Pillow`
2. 检查ImageTk模块是否可用
3. 重新安装依赖：`pip install --upgrade -r requirements.txt`

### 6. 依赖库问题

如果出现导入错误：

```bash
pip install --upgrade -r requirements.txt
```

## 技术架构

### 主要技术栈

- **GUI框架**：Tkinter
- **PDF处理**：PyMuPDF (fitz)
- **图像处理**：Pillow (PIL)
- **HTTP请求**：requests
- **Anki集成**：AnkiConnect API

### 核心功能模块

1. **PDF渲染模块**：负责PDF页面的渲染和显示
2. **区域选择模块**：处理鼠标事件和区域选择逻辑
3. **图像处理模块**：截取和处理选择的区域
4. **Anki通信模块**：与AnkiConnect API交互
5. **界面控制模块**：管理用户界面和交互逻辑

## 许可证

本项目采用MIT许可证，详情请参阅LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 更新日志

### v2.1.0 (当前版本)

- 🐛 修复NameError: name 'control_frame' is not defined错误
- 🐛 修复更新页面显示时'nameimagetk'isnotdefined错误
- 🔄 重构界面控件创建逻辑，提高代码稳定性
- ✨ 优化默认设置：默认不保存图片到本地
- ✨ 提升PDF预览质量：使用300 DPI渲染
- ✨ 改进多卡片创建体验：添加卡片后自动清除选择区域
- 🎨 优化状态栏提示信息
- 🛡️ 增强错误处理和异常捕获
- 🔧 改进代码结构和可维护性

### v2.0.0

- 🔄 完全重构代码，修复所有已知bug
- ✨ 新增缩放控制功能
- ✨ 新增区域拖拽调整功能
- ✨ 新增右键清除选择功能
- ✨ 新增适应页面功能
- 🎨 改进用户界面设计
- 🛡️ 增强错误处理机制
- 📱 优化窗口大小调整逻辑
- 🔧 改进坐标转换算法

### v1.0.0

- 🎉 初始版本发布
- 📄 基本PDF浏览功能
- 🖼️ 区域选择和截取功能
- 🎴 Anki集成功能
